# Групповые действия для материалов - Документация

## Обзор
Реализована расширенная система массовых действий для материалов, которая теперь поддерживает не только действия с выделенными элементами, но и групповые действия по критериям (категория, единица измерения, цена и т.д.).

## Новые возможности

### 1. Режимы работы

#### Режим выделенных элементов (по умолчанию)
- Действия применяются только к выделенным в таблице материалам
- Отображается количество выделенных элементов
- Стандартный режим массовых действий

#### Групповой режим
- Действия применяются ко всем материалам, соответствующим критериям
- Можно переключаться между режимами через кнопку в панели действий
- Отображается примерное количество элементов для обработки

### 2. Критерии группового режима

#### Поддерживаемые критерии:
- **По категории**: Все материалы в выбранной категории
- **По единице измерения**: Все материалы с определенной единицей измерения
- **По диапазону цен**: Материалы в заданном ценовом диапазоне
- **По статусу**: Активные/неактивные материалы
- **Все материалы**: Все материалы в системе
- **По поисковому запросу**: Материалы, найденные по текущему поиску

### 3. Доступные действия

#### Действия с ценами:
- **Увеличение цены на %**: Увеличить цену на заданный процент
- **Уменьшение цены на %**: Уменьшить цену на заданный процент
- **Конвертация валют**: Пересчет из USD в RUB и наоборот

#### Действия копирования:
- **Простое копирование**: Создание копий материалов
- **Копирование в категорию**: Создание копий в определенной категории
- **Копирование с изменениями**: Создание копий с модификацией цены

#### Другие действия:
- **Изменение категории**: Перемещение материалов в другую категорию
- **Деактивация**: Мягкое удаление материалов
- **Экспорт**: Экспорт выбранных материалов

### 4. API Endpoints

#### Групповые действия: `/api/material-items/group-actions`
```json
{
  "action": "update_prices_percent",
  "groupCriteria": {
    "type": "category",
    "categoryId": "category-id"
  },
  "params": {
    "operation": "increase",
    "percent": 10,
    "roundToInteger": false
  }
}
```

#### Оценка количества: `/api/material-items/group-actions`
```json
{
  "action": "estimate_count",
  "groupCriteria": {
    "type": "all"
  }
}
```

### 5. Безопасность

#### Подтверждение действий:
- Для операций с большим количеством элементов (>10) требуется подтверждение
- Предварительный просмотр количества затрагиваемых материалов
- Визуальные предупреждения для необратимых действий

#### Валидация:
- Проверка прав доступа на уровне API
- Валидация параметров действий
- Проверка существования целевых категорий

## Примеры использования

### Пример 1: Увеличение цены для всех материалов категории
```bash
curl -X POST http://localhost:3001/api/material-items/group-actions \
  -H "Content-Type: application/json" \
  -d '{
    "action": "update_prices_percent",
    "groupCriteria": {
      "type": "category",
      "categoryId": "cmcn50lhx0003ugc8mfo5tlut"
    },
    "params": {
      "operation": "increase",
      "percent": 15,
      "roundToInteger": true
    }
  }'
```

### Пример 2: Копирование всех материалов единицы измерения
```bash
curl -X POST http://localhost:3001/api/material-items/group-actions \
  -H "Content-Type: application/json" \
  -d '{
    "action": "copy_materials",
    "groupCriteria": {
      "type": "unit",
      "unit": "кг"
    },
    "params": {
      "namePrefix": "Копия",
      "categoryId": "target-category-id"
    }
  }'
```

### Пример 3: Оценка количества материалов
```bash
curl -X POST http://localhost:3001/api/material-items/group-actions \
  -H "Content-Type: application/json" \
  -d '{
    "action": "estimate_count",
    "groupCriteria": {
      "type": "all"
    }
  }'
```

## Локализация

Добавлена поддержка английского и русского языков для всех новых элементов интерфейса:

### Новые переводы:
- `bulkActions.groupMode` - "Групповые действия" / "Group actions"
- `bulkActions.allItems` - "Все элементы" / "All items"
- `bulkActions.switchToGroup` - "Переключиться на групповой режим" / "Switch to group mode"
- `bulkActions.confirmGroupAction` - "Подтверждение группового действия" / "Confirm group action"
- `bulkActions.estimatedCount` - "Примерное количество элементов" / "Estimated items affected"

## Компоненты

### Обновленные компоненты:
- `BulkActionsBar` - Панель массовых действий с поддержкой режимов
- `BulkActionDialog` - Диалог настройки действий с групповым режимом
- `MaterialsPage` - Главная страница с интеграцией новых возможностей

### Новые API:
- `group-actions/route.ts` - Endpoint для групповых действий
- Расширенные схемы валидации для групповых критериев

## Тестирование

Все новые возможности протестированы:
- ✅ API групповых действий
- ✅ Оценка количества элементов
- ✅ Действия с ценами по группам
- ✅ Интеграция с UI
- ✅ Локализация
- ✅ Валидация параметров

## Будущие улучшения

1. **Расширение критериев**: Добавление фильтрации по дате создания, поставщику
2. **Пакетная обработка**: Разделение больших операций на части
3. **Логирование**: Детальное логирование групповых действий
4. **Откат операций**: Возможность отмены групповых действий
5. **Предварительный просмотр**: Показ списка материалов перед действием
