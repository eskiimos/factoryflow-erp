# Концепция переработки ценообразования ERP

## Проблема
Сейчас все товары считаются "за штуку", но в производственной ERP нужно:
- Объемные буквы: цена за см² фасада
- Мебель: цена за м² площади
- Металлоконструкции: цена за кг веса
- Лестницы: цена за метр длины

## Решение

### 1. Расширить модель Product
```prisma
model Product {
  // ... существующие поля
  
  // Ценообразование
  pricingMethod     String  @default("FIXED")     // FIXED, PER_UNIT, PER_AREA, PER_VOLUME, PER_WEIGHT
  baseUnit          String  // м², м³, кг, м, см², шт
  basePrice         Float   @default(0)           // Цена за базовую единицу
  minimumOrder      Float   @default(1)           // Минимальный заказ в базовых единицах
  priceBreaks       String? // JSON: [{quantity: 100, price: 150}, ...]
  
  // Расчетные коэффициенты
  materialRate      Float   @default(1.0)         // Коэффициент материалов на единицу
  laborRate         Float   @default(1.0)         // Коэффициент работ на единицу
  complexityRate    Float   @default(1.0)         // Коэффициент сложности
}
```

### 2. Обновить Template для поддержки единиц
```prisma
model Template {
  // ... существующие поля
  
  // Единицы измерения и расчета
  calculationUnit   String  @default("шт")        // В чем считается (м², м³, шт)
  outputUnit        String  @default("шт")        // В чем выводится цена
  unitConversion    String? // JSON: формула пересчета единиц
  
  // Ценообразование
  pricingFormula    String? // Формула финальной цены: "totalCost * margin + setupCost"
  minimumPrice      Float   @default(0)
  setupCost         Float   @default(0)           // Фиксированная стоимость настройки
}
```

### 3. Обновить калькулятор
- Добавить параметр "единица измерения результата"
- Формулы должны возвращать цену за эту единицу
- Итоговая цена = (цена за единицу) × (количество единиц)

### 4. Примеры применения

#### Объемные буквы:
- calculationUnit: "см²"
- Параметры: высота букв, количество букв, тип материала
- Формула площади: height × totalLength
- Цена: area × pricePerCm2

#### Мебель:
- calculationUnit: "м²"  
- Параметры: длина, ширина, высота, материал
- Формула площади: length × width / 1000000
- Цена: area × pricePerM2

#### Металлоконструкции:
- calculationUnit: "кг"
- Параметры: размеры, тип металла, толщина
- Формула веса: volume × density
- Цена: weight × pricePerKg

## Преимущества:
1. ✅ Реальное производственное ценообразование
2. ✅ Гибкость: цена за любую единицу измерения  
3. ✅ Точность: учет реальных параметров изделия
4. ✅ Масштабируемость: легко добавлять новые типы товаров
5. ✅ Совместимость: существующие товары остаются "за штуку"
