const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

async function recreateWorkTypes() {
  try {
    console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–∏–¥—ã —Ä–∞–±–æ—Ç...');
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –≤–∏–¥—ã —Ä–∞–±–æ—Ç
    const deletedCount = await prisma.workType.deleteMany({});
    console.log(`‚úÖ –£–¥–∞–ª–µ–Ω–æ ${deletedCount.count} –≤–∏–¥–æ–≤ —Ä–∞–±–æ—Ç`);

    console.log('üè¢ –ü–æ–ª—É—á–∞–µ–º –æ—Ç–¥–µ–ª—ã...');
    
    // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–¥–µ–ª—ã
    const departments = await prisma.department.findMany({
      include: {
        employees: {
          where: { isActive: true }
        }
      }
    });

    console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${departments.length} –æ—Ç–¥–µ–ª–æ–≤`);

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—Ç–¥–µ–ª–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
    const findDepartment = (name) => {
      return departments.find(dept => 
        dept.name.toLowerCase().includes(name.toLowerCase())
      );
    };

    // –î–∞–Ω–Ω—ã–µ –Ω–æ–≤—ã—Ö –≤–∏–¥–æ–≤ —Ä–∞–±–æ—Ç
    const workTypes = [
      {
        name: "–ü—Ä–æ–∫–ª–µ–π–∫–∞ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–Ω–æ–π –ª–µ–Ω—Ç—ã",
        description: "–ü—Ä–æ–∫–ª–µ–π–∫–∞ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–Ω–æ–π –ª–µ–Ω—Ç—ã –Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
        group: "–°–±–æ—Ä–æ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
        cost: 5.00,
        unit: "–ø–æ–≥. –º.",
        departmentName: "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ"
      },
      {
        name: "–°–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–æ–¥–æ–≤ –∫–æ–º–º—É—Ç–∞—Ü–∏—è 1 —É–∑–ª–∞ —à—Ç 220 –í–æ–ª—å—Ç",
        description: "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –∫–æ–º–º—É—Ç–∞—Ü–∏—è –ø—Ä–æ–≤–æ–¥–æ–≤ 220–í",
        group: "–°–±–æ—Ä–æ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏", 
        cost: 30.00,
        unit: "—à—Ç",
        departmentName: "–≠–ª–µ–∫—Ç—Ä–∏–∫–∞"
      },
      {
        name: "–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞ –ê–ö–ü",
        description: "–§—Ä–µ–∑–µ—Ä–æ–≤–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –ø–æ –∞–ª—é–º–æ–∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–º –ø–∞–Ω–µ–ª—è–º",
        group: "–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞",
        cost: 15.00,
        unit: "–ø–æ–≥. –º.",
        departmentName: "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ"
      },
      {
        name: "–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞ –ê–∫—Ä–∏–ª–∞ 2-4 –º–º",
        description: "–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞ –∞–∫—Ä–∏–ª–æ–≤—ã—Ö –ø–∞–Ω–µ–ª–µ–π —Ç–æ–ª—â–∏–Ω–æ–π 2-4 –º–º",
        group: "–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞",
        cost: 10.00,
        unit: "–ø–æ–≥. –º.",
        departmentName: "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ"
      },
      {
        name: "–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞ –ü–í–• 2-6 –º–º",
        description: "–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞ –ü–í–• –ø–∞–Ω–µ–ª–µ–π —Ç–æ–ª—â–∏–Ω–æ–π 2-6 –º–º",
        group: "–§—Ä–µ–∑–µ—Ä–æ–≤–∫–∞",
        cost: 7.00,
        unit: "–ø–æ–≥. –º.",
        departmentName: "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ"
      },
      {
        name: "–°–±–æ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –∑–∞—Å–µ—á–∫–∞–º–∏ –∏ –∞–∫—Ä–∏–ª–æ–≤—ã–º –±–æ—Ä—Ç–æ–º –∑–∞ —Å–º",
        description: "–°–±–æ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –∑–∞—Å–µ—á–∫–∞–º–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ä–∏–ª–æ–≤–æ–≥–æ –±–æ—Ä—Ç–∞",
        group: "–°–±–æ—Ä–æ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
        cost: 100.00,
        unit: "–ø–æ–≥. –º.",
        departmentName: "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ"
      },
      {
        name: "–†–∞—Å–∫–∏–¥–∫–∞ –∑–∞–¥–Ω–∏–∫–æ–≤ –Ω–∞ (–∫–∞—Ä–∫–∞—Å–µ, –∫–æ–º–ø–æ–∑–∏—Ç–µ..) —Ä–∞—Å–∫–∏–¥–∞—Ç—å –∏ –∑–∞–∫—Ä–µ–ø–∏—Ç—å —à—Ç –≤ —Å–º",
        description: "–†–∞—Å–∫–ª–∞–¥–∫–∞ –∏ –∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∑–∞–¥–Ω–∏–∫–æ–≤ –Ω–∞ –∫–∞—Ä–∫–∞—Å–µ –∏–ª–∏ –∫–æ–º–ø–æ–∑–∏—Ç–µ",
        group: "–°–±–æ—Ä–æ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
        cost: 340.00,
        unit: "—á",
        departmentName: "–ú–æ–Ω—Ç–∞–∂"
      },
      {
        name: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ —Ñ—Ä–µ–∑–µ—Ä–æ–≤–∫—É (–ª–∏—Ü–æ, –±–æ—Ä—Ç–∞, –∑–∞–¥–Ω–∏–∫–∏) –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
        description: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Ñ—Ä–µ–∑–µ—Ä–æ–≤–∫–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞",
        group: "–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
        cost: 340.00,
        unit: "—á",
        departmentName: "–î–∏–∑–∞–π–Ω"
      },
      {
        name: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–ª—ë–Ω–∫–∏ –ø–æ–¥ –≤—ã–≤–µ—Å–∫—É –Ω–∞ –ø–ª–æ—Ç—Ç–µ—Ä–Ω—É—é —Ä–µ–∑–∫—É –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
        description: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–ª—ë–Ω–∫–∏ –¥–ª—è –ø–ª–æ—Ç—Ç–µ—Ä–Ω–æ–π —Ä–µ–∑–∫–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
        group: "–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
        cost: 340.00,
        unit: "—á",
        departmentName: "–î–∏–∑–∞–π–Ω"
      },
      {
        name: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —à–∞–±–ª–æ–Ω–∞ –ø–æ–¥ —Ä–∞—Å–∫–∏–¥–∫—É —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–≤ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
        description: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —à–∞–±–ª–æ–Ω–∞ –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–∫–∏ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–≤ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
        group: "–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
        cost: 340.00,
        unit: "—á",
        departmentName: "–î–∏–∑–∞–π–Ω"
      },
      {
        name: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —á–µ—Ä—Ç–µ–∂–µ–π –ø–æ–¥ –∫—Ä–µ–ø–ª–µ–Ω–∏—è –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –º–æ–Ω—Ç–∞–∂—É –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
        description: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —á–µ—Ä—Ç–µ–∂–µ–π –∫—Ä–µ–ø–µ–∂–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ –º–æ–Ω—Ç–∞–∂—É",
        group: "–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
        cost: 340.00,
        unit: "—á",
        departmentName: "–î–∏–∑–∞–π–Ω"
      },
      {
        name: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ–¥ —Å–±–æ—Ä–∫—É –≤—Å–µ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ",
        description: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–ª–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–±–æ—Ä–∫–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
        group: "–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏",
        cost: 340.00,
        unit: "—á",
        departmentName: "–î–∏–∑–∞–π–Ω"
      }
    ];

    console.log('üõ†Ô∏è –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –≤–∏–¥—ã —Ä–∞–±–æ—Ç...');
    
    let createdCount = 0;
    for (const workTypeData of workTypes) {
      const department = findDepartment(workTypeData.departmentName);
      
      if (!department) {
        console.log(`‚ö†Ô∏è –û—Ç–¥–µ–ª "${workTypeData.departmentName}" –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã "${workTypeData.name}"`);
        continue;
      }

      // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏–∑ –æ—Ç–¥–µ–ª–∞
      const assignedEmployee = department.employees.length > 0 ? department.employees[0] : null;

      const workType = await prisma.workType.create({
        data: {
          name: workTypeData.name,
          description: workTypeData.description,
          unit: workTypeData.unit,
          standardTime: 1.0, // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –≤—Ä–µ–º—è 1 —á–∞—Å
          hourlyRate: workTypeData.cost,
          currency: "RUB",
          skillLevel: "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç", // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
          departmentId: department.id,
          isActive: true
        }
      });

      createdCount++;
      console.log(`‚úÖ –°–æ–∑–¥–∞–Ω –≤–∏–¥ —Ä–∞–±–æ—Ç—ã: ${workType.name} - ${workType.hourlyRate} —Ä—É–±/${workType.unit} (–û—Ç–¥–µ–ª: ${department.name}${assignedEmployee ? `, –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: ${assignedEmployee.firstName} ${assignedEmployee.lastName}` : ', –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'})`);
    }

    console.log(`üéâ –°–æ–∑–¥–∞–Ω–æ ${createdCount} –Ω–æ–≤—ã—Ö –≤–∏–¥–æ–≤ —Ä–∞–±–æ—Ç!`);
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–¥–æ–≤ —Ä–∞–±–æ—Ç:', error);
  } finally {
    await prisma.$disconnect();
  }
}

recreateWorkTypes();
